import createLnRpc from "@radar/lnrpc";
import { updateData } from "../service/save_data";

export const connectLnd = async (invoice: string) => {
  const cert =
    "2d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0a4d494943786a4343416d75674177494241674951626b7656646947516f7a7336446638514e6533486654414b42676771686b6a4f50515144416a42434d5238770a485159445651514b45785a73626d5167595856306232646c626d56795958526c5a43426a5a584a304d523877485159445651514445785a7459574e7a4c5531680a59304a766232737455484a764c6d7876593246734d423458445449794d4463774d7a45304e5441774f466f584454497a4d4467794f4445304e5441774f466f770a516a45664d4230474131554543684d576247356b494746316447396e5a57356c636d46305a57516759325679644445664d4230474131554541784d576257466a0a6379314e59574e43623239724c5642796279357362324e686244425a4d424d4742797147534d34394167454743437147534d34394177454841304941424431650a6b6e317048737469425a465953396e7932746e6b6c696e71634f2b364833314a386d49764734757979496864677a3046416e734d38716f7252797750464878500a4d5767617134354f535a56327677426b7043326a676746424d4949425054414f42674e56485138424166384542414d4341715177457759445652306c424177770a436759494b775942425155484177457744775944565230544151482f42415577417745422f7a416442674e56485134454667515569547050735450306f704d5a0a5837352b647047616c4975684b6b777767655547413155644551534233544342326f49576257466a6379314e59574e43623239724c5642796279357362324e680a6249494a6247396a5957786f62334e3067675231626d6c3467677031626d6c346347466a613256306767646964575a6a623235756877522f41414142687841410a41414141414141414141414141414141414141426878442b67414141414141414141414141414141414141426878442b6741414141414141414154586e342f6c0a7038356d68775441714a79676878442b6741414141414141414a7a49772f2f2b4a4e65656878442b6741414141414141414d494a757376394a4877626878442b0a6741414141414141414c6a5354734166505369726878442b6741414141414141414d3642437879394c4161656878442b6741414141414141414b376553502f2b0a414245694d416f4743437147534d343942414d4341306b414d455943495144453137396e3042354b344c344e776d3647386b33525731707a4965476a4b4653660a6f6a4d34436e342f4a514968414d6561305433643752716d536d477a50587430594b5156735a626966624c3754716b45324f5539364d774a0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0a";
  try {
    const lnd = await createLnRpc({
      server: "127.0.0.1:11009",
      // tls: "/Users/mac/app-container/.lnd2/tls.cert",
      cert: Buffer.from(cert, "hex").toString("utf-8"),
      // macaroonPath:
      //   "/Users/mac/app-container/.lnd2/data/chain/bitcoin/regtest/admin.macaroon",
      macaroon:
        "0201036c6e6402f801030a10c86cd84ecf30a7f6ed66da137c3237a21201301a160a0761646472657373120472656164120577726974651a130a04696e666f120472656164120577726974651a170a08696e766f69636573120472656164120577726974651a210a086d616361726f6f6e120867656e6572617465120472656164120577726974651a160a076d657373616765120472656164120577726974651a170a086f6666636861696e120472656164120577726974651a160a076f6e636861696e120472656164120577726974651a140a057065657273120472656164120577726974651a180a067369676e6572120867656e6572617465120472656164000006205ccb4dd78e73e2f9c85db3c5fe996f62686d199c18628cdaa1dcd371c00f82f4",
    });
    const paymentInfo = await lnd.sendPaymentSync({ paymentRequest: invoice });
    await updateData(invoice, paymentInfo.paymentPreimage.toString("hex"));
    return paymentInfo.paymentPreimage.toString("hex");
  } catch (error) {
    console.log(error);
  }
};
